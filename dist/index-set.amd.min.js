define("index-set",function(){"use strict";var ENV={HINT_SIZE:256,END_OF_SET:0};function rangeStartForIndex(indexSet,index){var ranges=indexSet.__ranges__,lastIndex=indexSet.lastIndex+1,rangeStart,next,hint;if(index>=lastIndex){return lastIndex}if(Math.abs(ranges[index])>index){return index}hint=index-index%ENV.HINT_SIZE;rangeStart=ranges[hint];if(rangeStart<0||rangeStart>index){rangeStart=hint}next=ranges[rangeStart];if(typeof next==="undefined"){if(typeof rangeStart!=="undefined"){rangeStart=rangeStartForIndex(indexSet,rangeStart)}else{rangeStart=0}next=Math.abs(ranges[rangeStart])}else{next=Math.abs(next)}if(next===ENV.END_OF_SET){indexSet.removeAllIndexes();return-1}while(next<index){rangeStart=next;next=Math.abs(ranges[rangeStart])}return rangeStart}var enumeration__END_OF_SET=ENV.END_OF_SET;function forEach(indexSet,fn,scope){var ranges=indexSet.__ranges__,cursor=0,next=ranges[cursor];if(typeof scope==="undefined"){scope=null}while(next!==enumeration__END_OF_SET){if(next>0){for(var i=cursor;i<next;i++){fn.call(scope,i,indexSet)}}cursor=Math.abs(next);next=ranges[cursor]}}function map(indexSet,fn,scope){var ranges=indexSet.__ranges__,cursor=0,next=ranges[cursor],result=[];if(typeof scope==="undefined"){scope=null}while(next!==enumeration__END_OF_SET){if(next>0){for(var i=cursor;i<next;i++){result.push(fn.call(scope,i,indexSet))}}cursor=Math.abs(next);next=ranges[cursor]}return result}function reduce(indexSet,fn,initialValue){var ranges=indexSet.__ranges__,cursor=0,next=ranges[cursor],isValueSet=false,value;if(arguments.length>2){value=initialValue;isValueSet=true}while(next!==enumeration__END_OF_SET){if(next>0){for(var i=cursor;i<next;i++){if(isValueSet){value=fn(value,i,indexSet)}else{value=i;isValueSet=true}}}cursor=Math.abs(next);next=ranges[cursor]}if(!isValueSet){throw new TypeError("Reduce of empty IndexSet with no initial value")}return value}function some(indexSet,fn,scope){var ranges=indexSet.__ranges__,cursor=0,next=ranges[cursor];if(typeof scope==="undefined"){scope=null}while(next!==enumeration__END_OF_SET){if(next>0){for(var i=cursor;i<next;i++){if(fn.call(scope,i,indexSet)){return true}}}cursor=Math.abs(next);next=ranges[cursor]}return false}function every(indexSet,fn,scope){var ranges=indexSet.__ranges__,cursor=0,next=ranges[cursor];if(typeof scope==="undefined"){scope=null}while(next!==enumeration__END_OF_SET){if(next>0){for(var i=cursor;i<next;i++){if(!fn.call(scope,i,indexSet)){return false}}}cursor=Math.abs(next);next=ranges[cursor]}return true}function forEachRange(indexSet,fn,scope){var ranges=indexSet.__ranges__,cursor=0,next=ranges[cursor];if(typeof scope==="undefined"){scope=null}while(next!==enumeration__END_OF_SET){if(next>0){fn.call(scope,cursor,next-cursor,indexSet)}cursor=Math.abs(next);next=ranges[cursor]}}function someRange(indexSet,fn,scope){var ranges=indexSet.__ranges__,cursor=0,next=ranges[cursor];if(typeof scope==="undefined"){scope=null}while(next!==enumeration__END_OF_SET){if(next>0){if(fn.call(scope,cursor,next-cursor,indexSet)){return true}}cursor=Math.abs(next);next=ranges[cursor]}return false}function everyRange(indexSet,fn,scope){var ranges=indexSet.__ranges__,cursor=0,next=ranges[cursor];if(typeof scope==="undefined"){scope=null}while(next!==enumeration__END_OF_SET){if(next>0){if(!fn.call(scope,cursor,next-cursor,indexSet)){return false}}cursor=Math.abs(next);next=ranges[cursor]}return true}function addHintFor(indexSet,rangeStart,rangeLength){var ranges=indexSet.__ranges__,skip=ENV.HINT_SIZE,next=Math.abs(ranges[rangeStart]),hintLocation=rangeStart-rangeStart%skip+skip,limit=rangeStart+rangeLength;while(hintLocation<limit){while(next!==ENV.END_OF_SET&&next<=hintLocation){rangeStart=next;next=Math.abs(ranges[rangeStart])}if(next===ENV.END_OF_SET){if(rangeStart===0){indexSet.__ranges__=[0]}else if(ranges.hasOwnProperty(hintLocation)){delete ranges[hintLocation]}}else if(hintLocation!==rangeStart&&rangeStart!==ENV.END_OF_SET){ranges[hintLocation]=rangeStart}hintLocation+=skip}}var observing__toString=Object.prototype.toString,observing__slice=Array.prototype.slice,META_KEY="__js-index_set__"+(new Date).getTime(),T_FUNCTION="[object Function]",T_STRING="[object String]",observing__T_NUMBER="[object Number]",T_BOOLEAN="[object Boolean]",uuid=0,st={};function meta(o,create){var info=o&&o[META_KEY];if(create&&info==null){info=o[META_KEY]={}}return info}function destroy(o){if(o!=null){delete o[META_KEY]}}function metaPath(o,path,value){var i=0,len=path?path.length:0,m;if(arguments.length===3){m=meta(o,true);for(;i<len-1;i++){o=m[path[i]]||{};m[path[i]]=o;m=o}m[path[len-1]]=value;m=value}else{m=meta(o);for(;i<len;i++){m=m?m[path[i]]:undefined}}return m}function guidFor(o){if(o===null){return"(null)"}if(o===void 0){return"(undefined)"}var result,m,type=observing__toString.call(o);switch(type){case observing__T_NUMBER:result="nu"+o;break;case T_STRING:result=st[o];if(!result){result=st[o]="st"+uuid++}break;case T_BOOLEAN:result=o?"(true)":"(false)";break;default:if(o===Object){return"{}"}if(o===Array){return"[]"}m=meta(o,true);result=m.guid;if(!result){result=m.guid="obj"+uuid++}}return result}function set(hostObject,key,value){var currentValue=hostObject[key];if(currentValue!==value){trigger(hostObject,key+":before",value);hostObject[key]=value;trigger(hostObject,key+":change",value)}}function on(hostObject,event,target,method){if(observing__toString.call(method)!==T_FUNCTION){throw new TypeError(method+" is not callable.")}metaPath(hostObject,["events",event,guidFor(target),guidFor(method)],{method:method,target:target})}function off(hostObject,event,target,method){var m=metaPath(hostObject,["events",event,guidFor(target)]);if(m){delete m[guidFor(method)]}}function trigger(hostObject,event){var targetSets=metaPath(hostObject,["events",event]),args=observing__slice.call(arguments),subscription,set,subscriptions,k;if(targetSets){for(set in targetSets){subscriptions=targetSets[set];for(k in subscriptions){subscription=subscriptions[k];subscription.method.apply(subscription.target,args)}}}}var addition__END_OF_SET=ENV.END_OF_SET;function addIndex(indexSet,index){addIndexesInRange(indexSet,index,1)}function addRange(rangeStart,rangeLength){addIndexesInRange(this,rangeStart,rangeLength)}function addIndexes(indexSet,indexes){forEachRange(indexes,addRange,indexSet)}function addIndexesInRange(indexSet,rangeStart,rangeLength){var lastIndex=indexSet.lastIndex+1,ranges=indexSet.__ranges__,cursor,next,delta;if(rangeStart===lastIndex){if(rangeStart===addition__END_OF_SET){ranges[lastIndex]=lastIndex=rangeLength;delta=rangeLength}else{cursor=rangeStartForIndex(indexSet,rangeStart-1);next=ranges[cursor];if(next>0){delta=rangeStart-lastIndex+rangeLength;delete ranges[lastIndex];ranges[cursor]=lastIndex=rangeStart+rangeLength;rangeStart=cursor}else{ranges[lastIndex]=lastIndex=rangeStart+rangeLength;delta=rangeLength}}ranges[lastIndex]=addition__END_OF_SET;set(indexSet,"lastIndex",lastIndex-1);set(indexSet,"length",indexSet.length+delta);rangeLength=lastIndex-rangeStart}else if(rangeStart>lastIndex){ranges[lastIndex]=0-rangeStart;ranges[rangeStart]=rangeStart+rangeLength;ranges[rangeStart+rangeLength]=addition__END_OF_SET;set(indexSet,"lastIndex",rangeStart+rangeLength-1);set(indexSet,"length",indexSet.length+rangeLength);delta=rangeLength;rangeLength=rangeStart+rangeLength-lastIndex;rangeStart=lastIndex}else{cursor=rangeStartForIndex(indexSet,rangeStart);next=ranges[cursor];var rangeEnd=rangeStart+rangeLength;delta=0;if(rangeStart>0&&cursor===rangeStart&&next<=0){cursor=rangeStartForIndex(indexSet,rangeStart-1);next=ranges[cursor]}if(next<0){ranges[cursor]=0-rangeStart;if(Math.abs(next)>rangeEnd){ranges[rangeStart]=0-rangeEnd;ranges[rangeEnd]=next}else{ranges[rangeStart]=next}}else{rangeStart=cursor;if(next>rangeEnd){rangeEnd=next}}var value;cursor=rangeStart;while(cursor<rangeEnd){value=ranges[cursor];if(value===addition__END_OF_SET){ranges[rangeEnd]=addition__END_OF_SET;next=rangeEnd;delta+=rangeEnd-cursor}else{next=Math.abs(value);if(next>rangeEnd){ranges[rangeEnd]=value;next=rangeEnd}if(value<0){delta+=next-cursor}}delete ranges[cursor];cursor=next}cursor=ranges[rangeEnd];if(cursor>0){delete ranges[rangeEnd];rangeEnd=cursor}ranges[rangeStart]=rangeEnd;if(rangeEnd>lastIndex){set(indexSet,"lastIndex",rangeEnd-1)}set(indexSet,"length",indexSet.length+delta);rangeLength=rangeEnd-rangeStart}if(delta>0){cursor=ranges[0];if(cursor===addition__END_OF_SET){set(indexSet,"firstIndex",-1)}else if(cursor>0){set(indexSet,"firstIndex",0)}else{set(indexSet,"firstIndex",Math.abs(cursor))}}addHintFor(indexSet,rangeStart,rangeLength)}var removal__END_OF_SET=ENV.END_OF_SET;function removeIndex(indexSet,index){removeIndexesInRange(indexSet,index,1)}function removeRange(rangeStart,rangeLength){removeIndexesInRange(this,rangeStart,rangeLength)}function removeIndexes(indexSet,indexes){forEachRange(indexes,removeRange,indexSet)}function removeIndexesInRange(indexSet,rangeStart,rangeLength){var lastIndex=indexSet.lastIndex+1,ranges=indexSet.__ranges__,rangeEnd=rangeStart+rangeLength,cursor,next,delta=0;if(rangeStart>=lastIndex){return this}cursor=rangeStartForIndex(indexSet,rangeStart);next=ranges[cursor];if(rangeStart>0&&cursor===rangeStart&&next>0){cursor=rangeStartForIndex(indexSet,rangeStart-1);next=ranges[cursor]}if(next>0){ranges[cursor]=rangeStart;if(next>rangeEnd){ranges[rangeStart]=rangeEnd;ranges[rangeEnd]=next}else{ranges[rangeStart]=next}}else{rangeStart=cursor;next=Math.abs(next);if(next>rangeEnd){rangeEnd=next}}var value;cursor=rangeStart;while(cursor<rangeEnd){value=ranges[cursor];if(value===removal__END_OF_SET){ranges[rangeEnd]=removal__END_OF_SET;next=rangeEnd}else{next=Math.abs(value);if(next>rangeEnd){ranges[rangeEnd]=value;next=rangeEnd}if(value>0){delta+=next-cursor}}delete ranges[cursor];cursor=next}cursor=ranges[rangeEnd];if(cursor<0){delete ranges[rangeEnd];rangeEnd=Math.abs(cursor)}if(ranges[rangeEnd]===removal__END_OF_SET){delete ranges[rangeEnd];ranges[rangeStart]=removal__END_OF_SET;set(indexSet,"lastIndex",rangeStart-1)}else{ranges[rangeStart]=0-rangeEnd}set(indexSet,"length",indexSet.length-delta);rangeLength=rangeEnd-rangeStart;addHintFor(indexSet,rangeStart,rangeLength);if(delta!==0){cursor=ranges[0];if(cursor===removal__END_OF_SET){set(indexSet,"firstIndex",-1)}else if(cursor>0){set(indexSet,"firstIndex",0)}else{set(indexSet,"firstIndex",Math.abs(cursor))}}}function serializer(rangeStart,rangeLength){if(rangeLength===1){this.push(rangeStart)}else{this.push(rangeStart+"-"+(rangeStart+rangeLength-1))}}function serialize(indexSet){var buffer=[];forEachRange(indexSet,serializer,buffer);return buffer.join(",")}function deserialize(indexSet,string,strict){if(string===""){return indexSet}var ranges=string.split(","),range,rangeStart,rangeEnd;for(var i=0,len=ranges.length;i<len;i++){range=ranges[i];if(range.indexOf("-")!==-1){range=range.split("-");rangeStart=parseInt(range[0],10);rangeEnd=parseInt(range[1],10);if(isNaN(rangeEnd)){if(strict){throw new SyntaxError('Expected a complete range, instead got "'+ranges[i]+'".')}rangeEnd=rangeStart}if(rangeEnd<rangeStart){if(strict){throw new SyntaxError('Expected an ascending range, instead got a descending one: "'+ranges[i]+'".')}var swap=rangeEnd;rangeEnd=rangeStart;rangeStart=swap}else if(rangeEnd===rangeStart&&strict){throw new SyntaxError('Expected a range, not a no-op range: "'+ranges[i]+'".')}rangeEnd+=1;indexSet.addIndexesInRange(rangeStart,rangeEnd-rangeStart)}else{rangeStart=parseInt(range,10);if(!isNaN(rangeStart)){indexSet.addIndex(rangeStart)}else if(strict){throw new SyntaxError('Expected an index, but got non-number: "'+range+'".')}}}return indexSet}var queries__END_OF_SET=ENV.END_OF_SET;function containsIndex(indexSet,index){return containsIndexesInRange(indexSet,index,1)}function containsRange(rangeStart,rangeLength){return containsIndexesInRange(this,rangeStart,rangeLength)}function containsIndexes(indexSet,indexes){if(indexSet===indexes){return true}return everyRange(indexes,containsRange,indexSet)}function containsIndexesInRange(indexSet,rangeStart,rangeLength){var ranges=indexSet.__ranges__,cursor,next;cursor=rangeStartForIndex(indexSet,rangeStart);if(isFinite(cursor)){next=ranges[cursor];return next>0&&cursor<=rangeStart&&next>=rangeStart+rangeLength}else{return true}}function intersectsIndex(indexSet,index){return intersectsIndexesInRange(indexSet,index,1)}function intersectsRange(rangeStart,rangeLength){return intersectsIndexesInRange(this,rangeStart,rangeLength)}function intersectsIndexes(indexSet,indexes){if(indexSet===indexes){return true}return someRange(indexes,intersectsRange,indexSet)}function intersectsIndexesInRange(indexSet,rangeStart,rangeLength){var ranges=indexSet.__ranges__,cursor=rangeStartForIndex(indexSet,rangeStart),next=ranges[cursor],limit=rangeStart+rangeLength;while(cursor<limit){if(next===queries__END_OF_SET){return false}if(next>0&&next>rangeStart){return true}cursor=Math.abs(next);next=ranges[cursor]}return false}function equals(aIndexSet,bIndexSet){if(aIndexSet===bIndexSet){return true}if(bIndexSet==null||bIndexSet.lastIndex!==aIndexSet.lastIndex||bIndexSet.length!==aIndexSet.length){return false}var aRanges=aIndexSet.__ranges__,bRanges=bIndexSet.__ranges__,cursor=0,next=aRanges[cursor];do{if(bRanges[cursor]!==next){return false}cursor=Math.abs(next);next=aRanges[cursor]}while(cursor!==queries__END_OF_SET);return true}var indexes__END_OF_SET=ENV.END_OF_SET;function indexLessThanIndex(indexSet,index){return indexLessThanOrEqualToIndex(indexSet,index-1)}function indexLessThanOrEqualToIndex(indexSet,index){if(index<=0){return-1}var ranges=indexSet.__ranges__,lastIndex=indexSet.lastIndex+1,cursor=rangeStartForIndex(indexSet,index);while(cursor===lastIndex||ranges[cursor]<0){if(cursor===indexes__END_OF_SET){return-1}index=cursor-1;cursor=rangeStartForIndex(indexSet,index);if(cursor===-1){return cursor}}return index}function indexGreaterThanIndex(indexSet,index){return indexGreaterThanOrEqualToIndex(indexSet,index+1)}function indexGreaterThanOrEqualToIndex(indexSet,index){var ranges=indexSet.__ranges__,lastIndex=indexSet.lastIndex+1,cursor,next;if(index>=lastIndex){return-1}cursor=rangeStartForIndex(indexSet,index);next=ranges[cursor];while(next<0){if(next===indexes__END_OF_SET){return-1}index=cursor=Math.abs(next);next=ranges[cursor]}return index}var index_set__slice=Array.prototype.slice,index_set__toString=Object.prototype.toString,index_set__T_NUMBER="[object Number]",index_set__END_OF_SET=ENV.END_OF_SET;function invokeConcreteMethodFor(indexSet,fnName,args){if(args.length===1){if(args[0]instanceof IndexSet){return indexSet[fnName+"Indexes"](args[0])}else if(index_set__toString.call(args[0])===index_set__T_NUMBER){return indexSet[fnName+"Index"](args[0])}}else if(args.length===2){return indexSet[fnName+"IndexesInRange"](args[0],args[1])}}function IndexSet(){var args=index_set__slice.call(arguments);if(args.length===1&&args[0]instanceof IndexSet){var source=args[0];this.__ranges__=source.__ranges__.slice();this.length=source.length;this.firstIndex=source.firstIndex;this.lastIndex=source.lastIndex}else{this.__ranges__=[index_set__END_OF_SET];invokeConcreteMethodFor(this,"add",args)}}IndexSet.prototype={length:0,firstIndex:-1,lastIndex:-1,addIndex:function(index){addIndex(this,index);return this},addIndexes:function(indexSet){addIndexes(this,indexSet);return this},addIndexesInRange:function(rangeStart,rangeLength){addIndexesInRange(this,rangeStart,rangeLength);return this},removeIndex:function(index){removeIndex(this,index);return this},removeIndexes:function(indexSet){removeIndexes(this,indexSet);return this},removeAllIndexes:function(){trigger(this,"length:before",0);trigger(this,"firstIndex:before",-1);trigger(this,"lastIndex:before",-1);this.__ranges__=[0];this.length=0;this.firstIndex=-1;this.lastIndex=-1;trigger(this,"length:change",0);trigger(this,"firstIndex:change",-1);trigger(this,"lastIndex:change",-1);return this},removeIndexesInRange:function(rangeStart,rangeEnd){removeIndexesInRange(this,rangeStart,rangeEnd);return this},containsIndex:function(index){return containsIndex(this,index)},containsIndexes:function(indexSet){return containsIndexes(this,indexSet)},containsIndexesInRange:function(rangeStart,rangeLength){return containsIndexesInRange(this,rangeStart,rangeLength)},intersectsIndex:function(index){return intersectsIndex(this,index)},intersectsIndexes:function(indexSet){return intersectsIndexes(this,indexSet)},intersectsIndexesInRange:function(rangeStart,rangeEnd){return intersectsIndexesInRange(this,rangeStart,rangeEnd)},indexGreaterThanIndex:function(index){return indexGreaterThanIndex(this,index)},indexGreaterThanOrEqualToIndex:function(index){return indexGreaterThanOrEqualToIndex(this,index)},indexLessThanIndex:function(index){return indexLessThanIndex(this,index)},indexLessThanOrEqualToIndex:function(index){return indexLessThanOrEqualToIndex(this,index)},rangeStartForIndex:function(index){return rangeStartForIndex(this,index)},add:function(){invokeConcreteMethodFor(this,"add",index_set__slice.call(arguments));return this},remove:function(){invokeConcreteMethodFor(this,"remove",index_set__slice.call(arguments));return this},intersects:function(){return invokeConcreteMethodFor(this,"intersects",index_set__slice.call(arguments))},contains:function(){return invokeConcreteMethodFor(this,"contains",index_set__slice.call(arguments))},equals:function(indexSet){return equals(this,indexSet)},indexBefore:function(index){return indexLessThanIndex(this,index)},indexAfter:function(index){return indexGreaterThanIndex(this,index)},destroy:function(){destroy(this);this.removeAllIndexes()},copy:function(){return new IndexSet(this)},serialize:function(){return serialize(this)},on:function(key,target,method){return on(this,key,target,method)},off:function(key,target,method){return off(this,key,target,method)},forEach:function(fn,scope){forEach(this,fn,scope)},map:function(fn,scope){return map(this,fn,scope)},reduce:function(){var args=index_set__slice.call(arguments);args.unshift(this);return reduce.apply(null,args)},some:function(fn,scope){return some(this,fn,scope)},every:function(fn,scope){return every(this,fn,scope)},forEachRange:function(fn,scope){forEachRange(this,fn,scope)},someRange:function(fn,scope){someRange(this,fn,scope)},everyRange:function(fn,scope){everyRange(this,fn,scope)}};IndexSet.deserialize=function(string,strict){return deserialize(new IndexSet,string,strict)};IndexSet.ENV=ENV;var index_set=IndexSet;return index_set});